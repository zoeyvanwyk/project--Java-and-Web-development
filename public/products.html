<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Page</title>

        <!--CSS-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link rel="stylesheet" href="products.css">

    </head>
    <body>


        <!-- Header section -->
        <header class="header">
            <div class="navbar-header"> 
                <a class="navbar-brand" href="/">Crafters Corner</a>  
            </div>
            <h1 id="category-title">Loading...</h1>
        </header>
        
        <!-- The rest of your products page content -->
        <div class="container mt-5">
            <div class="row" id="products-container">
                <!-- Product cards will be dynamically inserted here -->
            </div>
        </div>


        <script>

            // Function to get query parameters
            function getQueryParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const queryArray = queryString.split("&");
                queryArray.forEach(param => {
                    const [key, value] = param.split("=");
                    params[key] = decodeURIComponent(value);
                });
                return params;
            }
    
            // Function to fetch category name from the server
            async function fetchCategoryName(categoryId) {
                try {
                    const response = await fetch(`http://localhost:3000/api/category/${categoryId}`);
                    // console.log(`Fetching category name for ID: ${categoryId}`);
                    if (response.ok) {
                        const data = await response.json();
                        // console.log('Fetched category name:', data.categoryName);
                        return data.categoryName;
                    } else {
                        console.log('Category not found');
                        return 'Unknown Category';
                    }
                } catch (error) {
                    console.error('Error fetching category name:', error);
                    return 'Unknown Category';
                }
            }
    
            // Get the category ID from URL
            const queryParams = getQueryParams();
            const categoryId = queryParams.category;
            console.log('Category ID from URL:', categoryId);
    
            // Fetch the category name and display it
            fetchCategoryName(categoryId).then(categoryName => {
                const categoryTitleElement = document.getElementById("category-title");
                categoryTitleElement.textContent = categoryName;
            });

            //  // Function to create an item box
            //  function createItemBox(item) {
            //     const itemBox = document.createElement('div');
            //     itemBox.className = 'item-box';
            //     itemBox.innerHTML = `
            //         <h2>${item.name}</h2>
            //         <p>${item.description}</p>
            //         <p>Price: $${item.price}</p>
            //         <p>Stock: ${item.stock}</p>
            //         <p>Material: ${item.material}</p>
            //         <p>Colour: ${item.colour}</p>
            //         <img src="${item.image}" alt="${item.name}">
            //     `;
            //     return itemBox;
            // }

            // Function to fetch items from the server
            async function fetchProducts(categoryId) {
                try {
                    const response = await fetch(`http://localhost:3000/api/stock/${categoryId}`);
                    if (response.ok) {
                        const products = await response.json();
                        return products;
                    } else {
                        console.error('Failed to fetch products')
                        // return 'Unknown Category'
                        // console.error('Error fetching items');
                        return [];
                    }
                } catch (error) {
                    console.error('Error fetching products:', error);
                    // return 'Unknown Category';
                    return [];
                }
            }


             // Function to fetch products from the server
            async function fetchProducts(categoryId) {
                try {
                    const response = await fetch(`http://localhost:3000/api/stock/${categoryId}`);
                    if (response.ok) {
                        const products = await response.json();
                        return products;
                    } else {
                        console.error('Failed to fetch products');
                        return [];
                    }
                } catch (error) {
                    console.error('Error fetching products:', error);
                    return [];
                }
            }

            
            // Function to create a product card
            function createProductCard(product) {
                return `
                    <div class="col-md-3 mb-3">
                        <div class="card">
                            <!-- Product image -->
                            <img class="images card-img-top" src="${product.image}" alt="${product.name}">
                            <!-- Product Details -->
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <!-- Product name -->
                                    <h5 class="fw-bolder">${product.name}</h5>
                                    <!-- Product Price -->
                                    R${product.price}.00
                                </div>
                            </div>
                            <!-- Product actions -->
                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                <div class="text-center">
                                    <a class="btn btn-outline-dark mt-auto" href="#">View options</a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

        
            
            // Function to display products on the page
            async function displayProducts() {
                const queryParams = await getQueryParams();
                const categoryId = queryParams.category;
                const categoryName = await fetchCategoryName(categoryId);

                const categoryTitleElement = document.getElementById("category-title");
                categoryTitleElement.textContent = categoryName;

                const products = await fetchProducts(categoryId);
                const productContainer = document.getElementById("products-container");
                productContainer.innerHTML = products.map(createProductCard).join('');
            }

            displayProducts();

        </script>
    </body>
    </html>
